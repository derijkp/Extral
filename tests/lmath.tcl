#!/bin/sh
# the next line restarts using wish \
exec tclsh "$0" "$@"

source tools.tcl

test lmath {calc} {
	lmath_calc {1 2.2 3.2 4} + {1 2 3.3 4.1}
} {2 4.2 6.5 8.1}

test lmath {calc} {
	lmath_calc {1 2 3.2 4} + 1
} {2 3 4.2 5}

test lmath {calc} {
	lmath_calc 10 - {1 2.0}
} {9 8.0}

test lmath {calc different lengths} {
	lmath_calc {1.0 2.0} + {1.0 2.0 3.0}
} {2.0 4.0}

test lmath {calc different lengths} {
	lmath_calc {1.0 2.0 3.0 5.0} - {1.0 1.0}
} {0.0 1.0}

test lmath {sum} {
	expr {round([lmath_sum {1 4 5}])}
} {10}

test lmath {sum doubles} {
	lmath_sum {1.2 4 5.2}
} {10.4}

test lmath {min} {
	lmath_min {5 1 100}
} {1}

test lmath {min bugfix} {
	lmath_min {{} 5 100 50}
} {expected floating-point number but got ""} 1

test lmath {max} {
	lmath_max {5 1 100 50}
} {100}

test lmath {max bugfix} {
	lmath_max {{} 5 100 50}
} {expected floating-point number but got ""} 1

test lmath {max} {
	lmath_max {}
} {}

test lmath {cumul} {
	lmath_cumul {5 1 100}
} {5 6 106}

test lmath {incr} {
	lmath_incr {8 18 100} 2
} {10 20 102}

test lmath {between} {
	lmath_between {-1 4 9 11 8} 0 10
} {0 4 9 10 8}

test lmath {average} {
	lmath_average {10 8 10 8}
} 9.0

test lmath {average} {
	lmath_average {9.8 9.9 10 10.1 10.2}
} 10.0

test lmath {filter average} {
	lmath_filter {1 8 1 9 10 5 8 9 10 9} {0.25 0.25 0.25 0.25}
} {4.75 4.75 4.75 7.0 6.25 8.0 8.0 8.0 9.0 9.0}

test lmath {filter average} {
	lmath_filter {1 8 1 9 10 5 8 9 10 9} {0.25 0.25 0.25 0.25} 1 {}
} {{} 4.75 7.0 6.25 8.0 8.0 8.0 9.0 {} {}}

test lmath {filter Savitsky-Golay 2-2} {
	set list {71 97 146 129 115 97 90 97 104 133 163 179 196 202 234 237 201 167 167 190 196 252 247 248 249 241 238 242 246 273 340 382 387 396 405 479 595 699 733 708 642 640 679 719 745 709 741 773 1086 1463 1725 1755 1528 1460 1515 1570 1639 1610 1586 1730 1874 2608 3440 3868 3657 3152 2934 2934 3168 3348 3151 2734 2923 3112 4015 4748 4859 4489 3940 3881 4001 4122 4090 3598 3031 3143 3255 3902 4485 4343 3893 3424 3433 3442 3591 3303 2698 1981 1516 1502 1500 1498 1405 1223 1160 1161 1163 1151 1003 805 683 724 766 839 862 800 685 674 671 669 625 523 359 256 208 191 176 175 149 141 133 131 130 105 86 62 50 47 38 30 29 22 21 23 25 31 26 21 22 23 30 42 48 42 36 34 34}
	set filter {-0.086 0.343 0.486 0.343 -0.086}
	lmath_filter $list $filter
} {132.478 132.478 132.478 135.533 113.112 98.021 91.448 93.904 107.676 132.483 160.434 181.321 191.797 209.886 230.159 232.653 201.772 170.664 169.471 180.815 211.258 236.753 253.272 248.258 247.031 242.027 238.767 239.42 246.493 280.012 335.467 377.479 390.866 390.066 412.503 481.624 595.356 693.136 732.457 700.559 652.944 641.421 676.849 721.852 729.754 725.96 710.986 815.547 1082.668 1457.783 1717.32 1717.331 1566.713 1467.359 1503.218 1580.822 1620.608 1604.835 1614.298 1664.812 1966.462 2608.762 3417.442 3818.759 3636.998 3207.613 2926.472 2959.91 3171.064 3307.097 3093.686 2856.546 2809.48 3248.714 3978.018 4697.624 4845.635 4457.617 4023.79 3869.383 3998.935 4135.311 4030.948 3566.341 3153.559 3038.596 3351.989 3907.396 4393.017 4354.316 3875.131 3507.372 3379.852 3503.522 3531.495 3296.007 2684.438 1994.938 1570.417 1465.266 1506.794 1490.093 1387.373 1245.499 1160.624 1156.871 1172.216 1133.248 999.61 808.278 704.251 707.487 775.515 835.094 856.323 789.303 706.654 666.338 674.095 666.72 624.026 512.14 370.033 257.493 208.399 187.472 180.372 167.973 154.228 138.936 133.94 132.719 125.294 108.52 83.597 63.708 51.023 45.114 38.085 31.627 26.856 23.284 20.997 22.398 26.63 28.775 26.43 22.026 20.968 23.596 30.855 41.576 46.464 42.688 36.512 36.512 36.512}

test lmath {filter Savitsky-Golay 2-2 2d deriv} {
	set list {71 97 146 129 115 97 90 97 104 133 163 179 196 202 234 237 201 167 167 190 196 252 247 248 249 241 238 242 246 273 340 382 387 396 405 479 595 699 733 708 642 640 679 719 745 709 741 773 1086 1463 1725 1755 1528 1460 1515 1570 1639 1610 1586 1730 1874 2608 3440 3868 3657 3152 2934 2934 3168 3348 3151 2734 2923 3112 4015 4748 4859 4489 3940 3881 4001 4122 4090 3598 3031 3143 3255 3902 4485 4343 3893 3424 3433 3442 3591 3303 2698 1981 1516 1502 1500 1498 1405 1223 1160 1161 1163 1151 1003 805 683 724 766 839 862 800 685 674 671 669 625 523 359 256 208 191 176 175 149 141 133 131 130 105 86 62 50 47 38 30 29 22 21 23 25 31 26 21 22 23 30 42 48 42 36 34 34}
	set filter {0.142857 -0.071429 -0.142857 -0.071429 0.142857}
	lmath_calc [lmath_filter $list $filter] / 2
} {-5.214337 -5.214337 -5.214337 -4.678632 0.5713715 1.892804 2.2856635 2.5713775 2.4285115 0.678504 -1.3572195 -1.6786595 0.749904 -0.071536 -4.03582 -6.1072455 -0.142958 5.428474 3.6784785 3.392763 -0.214396 -2.5358225 -3.714407 -0.2144095 -0.6072645 0.392735 1.107021 2.142734 5.3212945 4.1427065 -2.464447 -5.464462 -2.214478 4.9283685 9.964057 8.285456 -3.2860055 -12.571748 -14.2503375 -4.036054 6.856799 9.035375 2.0353725 -5.857493 -2.7860685 2.8567685 24.928176 34.67808 18.713708 -24.322107 -51.4293245 -32.7507805 7.4634745 24.534929 9.784947 -5.500783 -9.143643 5.5349025 18.3562895 54.141938 70.213131 23.784362 -81.9301085 -118.3230845 -56.6445555 25.3197555 60.5698465 36.784152 -16.0015545 -59.9658055 -7.215799 49.212718 94.2841585 64.355344 -11.6448105 -113.1449625 -108.7522005 -18.5378955 52.497855 54.2479605 1.962283 -49.180545 -65.573293 7.605355 67.3911045 86.7126275 52.748186 -20.430486 -104.251957 -86.1448655 10.105191 49.8552615 44.1410965 -16.2160255 -59.4659125 -73.1800705 -16.6441615 51.213181 67.1776335 33.4992125 -5.6436015 -16.107853 -7.536387 10.9636335 15.42796 3.677987 -11.143424 -19.1433795 -9.6433365 16.213848 22.9638805 13.9639095 -0.178962 -9.2146835 -16.464679 -4.321811 7.928195 8.3567955 -2.321762 -8.571744 -13.6431415 -6.428811 6.0355135 12.4641315 7.392738 3.428472 -0.1429485 -0.392938 0.142778 1.7142135 0.714217 -1.178636 -2.0714855 -1.428624 0.7499575 1.571393 1.3928285 0.0714065 0.178552 0.39284 0.285701 0.4285585 0.749988 0.499988 -0.357156 -0.892869 -0.3571555 0.6428445 0.857131 0.999986 0.5356975 -1.1428755 -1.714305 -0.571449 0.571409 0.571409 0.571409}

test lmath {lmath_majority} {
	set list {10 5 10 10000 8 9 10010 5 7}
	lmath_majority $list
} 9.0

test lmath {lmath_majority} {
	set list {10 5 10 10000 8 9 10010 5 7 -1000000}
	lmath_majority $list
} 9.0

test lmath {lmath_majority} {
	set list {0.7 -0.1 -0.3 0.7 -0.3 0.7 0.7 -0.4 0.7 0.7 -0.4 -0.4 0.7 -0.2 -0.4 0.7 -0.3 0.7 -0.1 0.8 -0.3 0.6 -0.3 0.7 -0.2 -0.1 -0.0 -0.3 -0.3 -0.4 0.7 -0.4 -0.4 -0.0 -0.4 0.7 -0.1 0.4 -0.1 -0.3 -0.2 -0.2 0.7 -0.4 -0.1 -0.3}
	lmath_majority $list
} -0.3

test lmath {lmath_majority} {
	set list {0 1 2 3 4 5 6 7 8 9}
	lmath_majority $list
} 4.5

test lmath {lmath_majority} {
	set list {0 1 1.5 2 3 4 5 6 7 8 9}
	lmath_majority $list
} 1.5

test lmath {lmath_majority} {
	set list {0 1 1.5 2 3 4 5 6 7 7.5 8 8.5 9}
	lmath_majority $list
} 8.0

test lmath {lmath_majority} {
	set list {0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 -1.0 0.9 0.9 0.9 -1.0}
	lmath_majority $list
} 0.9

test lmath {lmath_majoritydev} {
	set list {10 5 10 10000 8 9 10010 5 7 -1000000}
	set m [lmath_majority $list]
	lmath_majoritydev $list $m
} 1.0

test lmath {lmath_majoritydev} {
	set list {-0.2 -0.2 -0.3 -0.3 -0.4}
	set m [lmath_majority $list]
	lmath_majoritydev $list $m
} 0.1



testsummarize


