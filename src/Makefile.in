#
# This file is a Makefile.  If it has the name "Makefile.in"
# then it is a template for a Makefile;  to generate the actual Makefile,
# run "./configure", which is a configuration script generated by the
# "autoconf" program (constructs like "@foo@" will get replaced in the
# actual Makefile.
#

# set to yes to compile with debugging information
DEBUG=no
# set to no to compile without stubs support
USE_STUBS=@USE_STUBS@

#----------------------------------------------------------------
# The information below is modified by the configure script when
# Makefile is generated from Makefile.in.  You shouldn't normally
# modify any of this stuff by hand.
#----------------------------------------------------------------

PROJECT = extral
TCLEXE = extratcl
OBJECTS = extralInit.o extral.o list_pop.o string.o array.o supersort.o general.o structl.o structltypes.o date.o
SRCS = extralInit.c extral.c list_pop.c string.c array.c supersort.c general.c structl.c structltypes.c date.c

ifeq ($(DEBUG),yes)
	CFLAGS = @TCL_CFLAGS_DEBUG@ @TCL_CFLAGS_WARNING@ 
else
	CFLAGS = @TCL_CFLAGS_OPTIMIZE@ @TCL_CFLAGS_WARNING@
endif

ifeq ($(USE_STUBS),yes)
	LD_LIBS = @TCL_STUB_LIB_SPEC@ @TCL_SHLIB_LD_LIBS@
	DEFS = @TCL_DEFS@ -DUSE_TCL_STUBS
else
	LD_LIBS = @TCL_LIB_SPEC@ @TCL_SHLIB_LD_LIBS@
	LD_LIBS = @TCL_SHLIB_LD_LIBS@
	DEFS = @TCL_DEFS@
endif

INCLUDES = -I@TCL_EXEC_PREFIX@/include
CC = @TCL_CC@
SHLIB_LD =		@TCL_SHLIB_LD@
SHLIB_SUFFIX =		@TCL_SHLIB_SUFFIX@

CC_SWITCHES = $(INCLUDES) $(CFLAGS)	@TCL_SHLIB_CFLAGS@ $(DEFS)
TCL_LD_LIBS = @TCL_LIB_SPEC@ @TCL_SHLIB_LD_LIBS@ @TCL_LIBS@

# --------------------------- Rules -----------------------------

all: depend $(PROJECT)${SHLIB_SUFFIX}

$(PROJECT)${SHLIB_SUFFIX}: $(OBJECTS)
	${SHLIB_LD} $(OBJECTS) -o ../$(PROJECT)$(SHLIB_SUFFIX) $(LD_LIBS)

$(TCLEXE): tclAppInit.o $(OBJECTS)
	${CC} tclAppInit.o $(OBJECTS) -o $(TCLEXE) $(TCL_LD_LIBS)

test:
	cd ../tests ; ./all.tcl

install: 
	../makedoc.tcl
	../makedist.tcl @INSTALL_DIR@

clean:
	rm -f ../$(PROJECT)$(SHLIB_SUFFIX) $(TCLEXE) $(WISHEXE) *.o
	rm -rf win/*.csm ../*.dll ./*.dll win/tmp/*
	rm -f core ../core ../tests/core

distclean: clean
	rm -f config.cache config.log config.status Makefile

Makefile: Makefile.in
	./config.status

depend:
	makedepend -- $(CC_SWITCHES) -- $(SRCS)

.c.o:
	$(CC) -c $(CC_SWITCHES) $<
